<app-header>
</app-header>
<div class="contents">
    <div class="container p-3">
        <div class="row">
            <div class="col-3">
                <div *ngIf="environment.PURCHASE_TERMS">
                    <h2 class="text-large mb-4 text-center font-weight-bold">{{ 'purchase.cinema.seat.terms' | translate }}</h2>
                    <div class="mb-4">
                        <app-purchase-terms [language]="(user | async)?.language"
                            [screeningEvent]="(purchase | async)?.screeningEvent"></app-purchase-terms>
                    </div>
                </div>
            </div>
            <div class="col-6">
                <app-screen *ngIf="(user | async)?.theater 
                && screeningEventSeats.length > 0 
                && (purchase | async)?.screen" [theaterCode]="(user | async)?.theater.branchCode"
                    [screenCode]="(purchase | async)?.screen.branchCode" [screeningEventSeats]="screeningEventSeats"
                    [openSeatingAllowed]="(purchase | async)?.screen.openSeatingAllowed"
                    [reservations]="(purchase | async)?.reservations"
                    [authorizeSeatReservation]="(purchase | async)?.authorizeSeatReservation"
                    (select)="selectSeat($event)">
                </app-screen>
                <app-seat-info class="mb-4"></app-seat-info>
                <div *ngIf="(purchase | async)?.screen?.openSeatingAllowed" class="mb-4">
                    <div class="d-flex align-items-center">
                        <p class="mr-2">{{ 'purchase.cinema.seat.openSeating' | translate }}</p>
                        <select class="form-control d-inline-block w-auto" (change)="selectOpenSeating($event)"
                            [ngModel]="(purchase | async)?.reservations.length">
                            <option value="0">0</option>
                            <option *ngFor="let value of remainingAttendeeCapacityValue({
                                screeningEvent: (purchase | async)?.screeningEvent,
                                screeningEventSeats: screeningEventSeats,
                                authorizeSeatReservations: (purchase | async)?.authorizeSeatReservations
                            })" [value]="value">{{ value }}</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-3">
                <app-purchase-info class="mb-4" [purchase]="purchase | async"></app-purchase-info>
            </div>
        </div>
    </div>
</div>
<app-footer>
    <div class="mr-auto">
        <button type="button" class="btn btn-outline-primary"
            (click)="prev()">{{ 'purchase.cinema.seat.prev' | translate }}</button>
    </div>
    <div>
        <button *ngIf="!environment.PURCHASE_TERMS" type="submit" class="btn btn-primary"
            [disabled]="isLoading | async" (click)="onSubmit()">{{ 'purchase.cinema.seat.next' | translate }}</button>
        <button *ngIf="environment.PURCHASE_TERMS" type="submit" class="btn btn-primary"
            [disabled]="isLoading | async"
            (click)="onSubmit()">{{ 'purchase.cinema.seat.consent' | translate }}</button>
    </div>
</app-footer>

